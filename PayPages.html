<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ - –°–∏–ª–æ–≤–∏–∫</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.0/dist/qrious.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      background-color: #0f172a;
      color: white;
      font-family: 'Inter', system-ui, sans-serif;
    }
    .payment-card {
      background: rgba(30, 41, 59, 0.7);
      border: 1px solid #334155;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
    }
    .form-input {
      background: #1e293b;
      border: 1px solid #334155;
      color: white;
      padding: 14px;
      border-radius: 12px;
      width: 100%;
      transition: all 0.3s;
    }
    .form-input:focus {
      outline: none;
      border-color: #f59e0b;
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3);
    }
    .payment-btn {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: #0f172a;
      font-weight: 700;
      padding: 16px;
      border-radius: 12px;
      width: 100%;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.4);
      opacity: 0.7;
      pointer-events: none;
    }
    .payment-btn.active {
      opacity: 1;
      pointer-events: auto;
    }
    .payment-btn.active:hover {
      background: linear-gradient(135deg, #d97706, #b45309);
      transform: translateY(-2px);
      box-shadow: 0 6px 8px -1px rgba(245, 158, 11, 0.6);
    }
    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #334155;
    }
    .summary-total {
      display: flex;
      justify-content: space-between;
      padding: 16px 0;
      font-size: 20px;
      font-weight: bold;
      color: #f59e0b;
    }
    .sbp-qr {
      display: none;
      text-align: center;
      margin-top: 24px;
    }
    .sbp-qr canvas {
      max-width: 100%;
      background: white;
      padding: 12px;
      border-radius: 12px;
    }
    .error {
      border-color: #ef4444 !important;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3) !important;
    }
  </style>
</head>
<body class="min-h-screen">

  <!-- –ù–∞–≤–±–∞—Ä -->
  <nav class="bg-black/90 backdrop-blur border-b border-yellow-500/30 shadow-md shadow-black/40 fixed top-0 left-0 w-full z-50">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
      <a href="index.html" class="flex items-center space-x-3">
        <div class="h-10 w-10 rounded-full bg-gradient-to-br from-yellow-500 to-yellow-600 flex items-center justify-center shadow-lg shadow-yellow-500/40">
          <span class="font-bold text-black text-xl">S</span>
        </div>
        <span class="self-center text-3xl font-extrabold text-yellow-500 tracking-wide">–°–∏–ª–æ–≤–∏–∫</span>
      </a>
      <div class="text-lg text-gray-300">–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</div>
    </div>
  </nav>

  <main class="max-w-screen-xl mx-auto px-4 pt-28 pb-16">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- –§–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã -->
      <div class="lg:w-2/3">
        <div class="payment-card">
          <h2 class="text-2xl font-bold text-yellow-400 mb-6">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞</h2>
          
          <form id="paymentForm">
            <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <div>
                <label class="block text-gray-300 mb-2">–ò–º—è *</label>
                <input type="text" id="firstName" class="form-input" placeholder="–ò–≤–∞–Ω" required>
                <p class="text-red-400 text-sm mt-1 hidden" id="firstNameError">–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã</p>
              </div>
              <div>
                <label class="block text-gray-300 mb-2">–§–∞–º–∏–ª–∏—è *</label>
                <input type="text" id="lastName" class="form-input" placeholder="–ò–≤–∞–Ω–æ–≤" required>
                <p class="text-red-400 text-sm mt-1 hidden" id="lastNameError">–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã</p>
              </div>
            </div>
            <div class="mb-6">
              <label class="block text-gray-300 mb-2">Email *</label>
              <input type="email" id="email" class="form-input" placeholder="ivan@example.com" required>
              <p class="text-red-400 text-sm mt-1 hidden" id="emailError">–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email</p>
            </div>
            <div class="mb-6">
              <label class="block text-gray-300 mb-2">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
              <input type="tel" id="phone" class="form-input" placeholder="+7 (999) 123-45-67" required>
            </div>
            
            <!-- –ê–¥—Ä–µ—Å -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold mb-4 text-yellow-300">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-gray-300 mb-2">–ì–æ—Ä–æ–¥ *</label>
                  <input type="text" id="city" class="form-input" placeholder="–ú–æ—Å–∫–≤–∞" required>
                </div>
                <div>
                  <label class="block text-gray-300 mb-2">–ò–Ω–¥–µ–∫—Å *</label>
                  <input type="text" id="zip" class="form-input" placeholder="123456" required>
                </div>
              </div>
              <div class="mt-4">
                <label class="block text-gray-300 mb-2">–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞ *</label>
                <input type="text" id="address" class="form-input" placeholder="—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10, –∫–≤. 5" required>
              </div>
            </div>

            <!-- –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold mb-4 text-yellow-300">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h3>
              <div class="flex gap-4 mb-6">
                <button type="button" class="flex-1 py-3 px-4 bg-slate-700 rounded-lg text-center font-medium active:bg-yellow-500/20 active:text-yellow-400" data-method="card">–ö–∞—Ä—Ç–∞</button>
                <button type="button" class="flex-1 py-3 px-4 bg-slate-700 rounded-lg text-center font-medium" data-method="sbp">–°–ë–ü</button>
              </div>

              <div id="cardDetails">
                <div class="mb-4">
                  <label class="block text-gray-300 mb-2">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã *</label>
                  <input type="text" id="cardNumber" class="form-input" placeholder="0000 0000 0000 0000" maxlength="19" required>
                </div>
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label class="block text-gray-300 mb-2">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è *</label>
                    <input type="text" id="cardExpiry" class="form-input" placeholder="–ú–ú/–ì–ì" maxlength="5" required>
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2">CVV *</label>
                    <input type="text" id="cardCVV" class="form-input" placeholder="123" maxlength="3" required>
                  </div>
                </div>
              </div>

              <div id="sbpQr" class="sbp-qr">
                <p class="mb-4 text-center text-yellow-400 font-medium">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –°–ë–ü</p>
                <canvas id="qrCanvas"></canvas>
              </div>
            </div>
            
            <button type="submit" id="submitBtn" class="payment-btn">
              –û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑ (<span id="totalAmount">0</span> ‚ÇΩ)
            </button>
          </form>
        </div>
      </div>
      
      <!-- –°–≤–æ–¥–∫–∞ –∑–∞–∫–∞–∑–∞ -->
      <div class="lg:w-1/3">
        <div class="payment-card sticky top-32">
          <h2 class="text-2xl font-bold text-yellow-400 mb-6">–í–∞—à –∑–∞–∫–∞–∑</h2>
          <div id="orderItems" class="space-y-4 mb-6"></div>
          <div class="summary-total">
            <span>–ò—Ç–æ–≥–æ</span>
            <span id="orderTotal">0 ‚ÇΩ</span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // === –ü–†–û–í–ï–†–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ===
    if (!localStorage.getItem('isLoggedIn')) {
      Swal.fire({
        icon: 'warning',
        title: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è',
        text: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞',
        confirmButtonText: '–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤—Ö–æ–¥—É',
        customClass: { popup: 'shadow-2xl rounded-xl' }
      }).then(() => {
        window.location.href = 'Authorization.html';
      });
    }

    // === –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –¢–ï–õ–ï–§–û–ù–ê ===
    document.getElementById('phone').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '').substring(0, 11);
      if (value.length === 0) return e.target.value = '';
      if (value[0] !== '7' && value[0] !== '8') value = '7' + value;
      if (value[0] === '8') value = '7' + value.substring(1);
      let formatted = '+7';
      if (value.length > 1) formatted += ' (' + value.substring(1, 4);
      if (value.length >= 4) formatted += ') ' + value.substring(4, 7);
      if (value.length >= 7) formatted += '-' + value.substring(7, 9);
      if (value.length >= 9) formatted += '-' + value.substring(9, 11);
      e.target.value = formatted;
    });

    // === –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –ö–ê–†–¢–´ –ò –°–†–û–ö–ê ===
    document.getElementById('cardNumber').addEventListener('input', function(e) {
      let v = e.target.value.replace(/\D/g, '');
      let f = '';
      for (let i = 0; i < v.length; i++) {
        if (i > 0 && i % 4 === 0) f += ' ';
        f += v[i];
      }
      e.target.value = f.substring(0, 19);
    });
    document.getElementById('cardExpiry').addEventListener('input', function(e) {
      let v = e.target.value.replace(/\D/g, '');
      if (v.length >= 2) v = v.substring(0, 2) + '/' + v.substring(2, 4);
      e.target.value = v;
    });

    // === –í–´–ë–û–† –°–ü–û–°–û–ë–ê –û–ü–õ–ê–¢–´ ===
    document.querySelectorAll('[data-method]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-method]').forEach(b => {
          b.classList.remove('bg-yellow-500/20', 'text-yellow-400');
          b.classList.add('bg-slate-700');
        });
        btn.classList.add('bg-yellow-500/20', 'text-yellow-400');
        btn.classList.remove('bg-slate-700');

        const method = btn.dataset.method;
        document.getElementById('cardDetails').style.display = method === 'card' ? 'block' : 'none';
        document.getElementById('sbpQr').style.display = method === 'sbp' ? 'block' : 'none';
        if (method === 'sbp') generateSbpQr();
      });
    });

    function generateSbpQr() {
      const total = document.getElementById('orderTotal').textContent.replace(' ‚ÇΩ', '');
      const qrData = `spb://pay?amount=${total}&currency=RUB&name=–°–∏–ª–æ–≤–∏–∫&description=–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞`;
      new QRious({ element: document.getElementById('qrCanvas'), value: qrData, size: 240 });
    }

    // === –ó–ê–ì–†–£–ó–ö–ê –ö–û–†–ó–ò–ù–´ ===
    function loadCart() {
      const cart = JSON.parse(localStorage.getItem('cartForCheckout')) || [];
      if (cart.length === 0) {
        Swal.fire({
          icon: 'info',
          title: '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞',
          text: '–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞',
          confirmButtonText: '–í –∫–∞—Ç–∞–ª–æ–≥',
          customClass: { popup: 'shadow-2xl rounded-xl' }
        }).then(() => window.location.href = 'katalog.html');
        return;
      }
      const items = document.getElementById('orderItems');
      const totalEl = document.getElementById('orderTotal');
      const amountEl = document.getElementById('totalAmount');

      let total = 0;
      items.innerHTML = '';
      cart.forEach(item => {
        const div = document.createElement('div');
        div.className = 'flex items-center gap-4 pb-4 border-b border-slate-700';
        div.innerHTML = `
          <img src="${item.img}" alt="${item.name}" class="w-16 h-16 object-cover rounded">
          <div class="flex-1">
            <h3 class="font-medium">${item.name}</h3>
            <p class="text-sm text-gray-400">1 —à—Ç.</p>
          </div>
          <div class="font-bold text-orange-400">${item.price} ‚ÇΩ</div>
        `;
        items.appendChild(div);
        total += item.price;
      });

      totalEl.textContent = `${total} ‚ÇΩ`;
      amountEl.textContent = total;
    }

    // === –í–ê–õ–ò–î–ê–¶–ò–Ø ===
    function validateForm() {
      let isValid = true;

      const nameRegex = /^[–∞-—è–ê-–Ø—ë–Åa-zA-Z\s]+$/;
      ['firstName', 'lastName'].forEach(field => {
        const el = document.getElementById(field);
        const errorEl = document.getElementById(field + 'Error');
        if (!nameRegex.test(el.value.trim())) {
          el.classList.add('error');
          errorEl.classList.remove('hidden');
          isValid = false;
        } else {
          el.classList.remove('error');
          errorEl.classList.add('hidden');
        }
      });

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const emailEl = document.getElementById('email');
      const emailError = document.getElementById('emailError');
      if (!emailRegex.test(emailEl.value.trim())) {
        emailEl.classList.add('error');
        emailError.classList.remove('hidden');
        isValid = false;
      } else {
        emailEl.classList.remove('error');
        emailError.classList.add('hidden');
      }

      const phone = document.getElementById('phone').value.replace(/\D/g, '');
      if (phone.length !== 11 || phone[0] !== '7') {
        document.getElementById('phone').classList.add('error');
        isValid = false;
      } else {
        document.getElementById('phone').classList.remove('error');
      }

      return isValid;
    }

    // === –û–¢–ü–†–ê–í–ö–ê "–ß–ï–ö–ê" ===
    function simulateEmailReceipt(client, cart, total) {
      const now = new Date().toLocaleString('ru-RU');
      const receipt = `
üìß –ß–µ–∫ –æ—Ç –°–∏–ª–æ–≤–∏–∫
===========================
–û—Ç: silovik23.103@mail.ru
–ö–æ–º—É: ${client.email}
–î–∞—Ç–∞: ${now}
===========================
–ü–æ–∫—É–ø–∞—Ç–µ–ª—å: ${client.firstName} ${client.lastName}
–¢–µ–ª–µ—Ñ–æ–Ω: ${client.phone}
–ê–¥—Ä–µ—Å: ${client.city}, ${client.address}, ${client.zip}
===========================
–¢–æ–≤–∞—Ä—ã:
${cart.map(item => `‚Ä¢ ${item.name} ‚Äî ${item.price} ‚ÇΩ`).join('\n')}
===========================
–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ
–°—Ç–∞—Ç—É—Å: –û–ü–õ–ê–ß–ï–ù–û ‚úÖ
===========================
–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É –≤ –°–∏–ª–æ–≤–∏–∫!
      `.trim();

      console.log("‚úâÔ∏è –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email:");
      console.log("–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:", "silovik23.103@mail.ru");
      console.log("–ü–æ–ª—É—á–∞—Ç–µ–ª—å:", client.email);
      console.log("–¢–µ–ª–æ –ø–∏—Å—å–º–∞:\n", receipt);
    }

    // === –û–ë–†–ê–ë–û–¢–ö–ê –§–û–†–ú–´ ===
    document.getElementById('paymentForm').addEventListener('submit', function(e) {
      e.preventDefault();

      if (!validateForm()) {
        Swal.fire({
          icon: 'error',
          title: '–û—à–∏–±–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö',
          text: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π',
          customClass: { popup: 'shadow-2xl rounded-xl' }
        });
        return;
      }

      const client = {
        firstName: document.getElementById('firstName').value.trim(),
        lastName: document.getElementById('lastName').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        city: document.getElementById('city').value.trim(),
        zip: document.getElementById('zip').value.trim(),
        address: document.getElementById('address').value.trim()
      };

      const cart = JSON.parse(localStorage.getItem('cartForCheckout')) || [];
      const total = document.getElementById('orderTotal').textContent.replace(' ‚ÇΩ', '');

      simulateEmailReceipt(client, cart, total);

      const order = {
        id: 'ORD-' + Date.now().toString().slice(-6),
        date: new Date().toISOString(),
        client,
        items: cart,
        total: parseInt(total),
        status: 'paid'
      };
      const orders = JSON.parse(localStorage.getItem('orders') || '[]');
      orders.push(order);
      localStorage.setItem('orders', JSON.stringify(orders));
      localStorage.removeItem('cartForCheckout');
      localStorage.setItem('cart', '[]');

      Swal.fire({
        icon: 'success',
        title: '–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!',
        html: `
          <div class="text-center space-y-2">
            <p>–ß–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç <strong>silovik23.103@mail.ru</strong></p>
            <p>–Ω–∞ email: <strong>${client.email}</strong></p>
            <p class="text-sm text-gray-400">–ó–∞–∫–∞–∑: <strong>${order.id}</strong></p>
          </div>
        `,
        confirmButtonText: '–ù–∞ –≥–ª–∞–≤–Ω—É—é',
        customClass: {
          popup: 'shadow-2xl rounded-xl',
          title: 'text-yellow-500'
        },
        iconColor: '#f59e0b'
      }).then(() => {
        window.location.href = 'index.html';
      });
    });

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    loadCart();
    document.querySelector('[data-method="card"]').click();

    setTimeout(() => {
      document.getElementById('submitBtn').classList.add('active');
    }, 300);
  </script>
</body>
</html>


<script>
    localStorage.setItem('isLoggedIn', 'true');
</script>
</body>
</html>                    